[[extend 'layout.html']]

[[block page_head]]
<link rel="stylesheet" href="[[=URL('static/components-bulma/grid/grid.css')]]">
[[end]]

<style>
[v-cloak] {
     display: none;
}
</style>

<div class="section" id="vue-target" v-cloak>
  <!-- Put here your Vue.js template -->
  <h1 class="title">[[=assignment_name]]</h1>

  <!-- Section with general information about the homework. -->

  <p class="mt-2"><b>Submission deadline:</b> 
    <span @mouseover="show_deadline_help = true" @mouseout="show_deadline_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span>
    {{submission_deadline}}</p>
  <div class="box has-background-primary-light has-text-primary-dark" v-if="show_deadline_help">
    <p>Late submissions are graded, but the grade will not be used unless the instructor manually flags it as valid.</p>
  </div>
  
  <p class="mt-2"><b>Late submission possible until:</b> 
    <span @mouseover="show_late_help = true" @mouseout="show_late_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span> 
    {{date_closes}}</p>
  <div class="box has-background-primary-light has-text-primary-dark" v-if="show_late_help">
    <p>Late submissions are graded, but the grade will not be used unless the instructor manually flags it as valid.</p>
  </div>

  <p class="mt-2"><b>Grading limit:</b> 
    <span @mouseover="show_grade_limit_help = true" @mouseout="show_grade_limit_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span> 
    {{grading_limit}} every 24h</p>
  <div class="box has-background-primary-light has-text-primary-dark" v-if="show_grade_limit_help">
    <p>You can have your homeowrk graded at most this number of times every 24h.</p>
  </div>

  <!-- Section for accessing the homework. -->
  
  <h2 class="subtitle mt-5">Your Assignment</h2>
  <div v-if="drive_url">
    <a :href="drive_url" target="_blank" class="button is-success mt-3">Access assignment</a>
  </div>
  <div v-else-if="assignment_is_available">
    <p class="has-text-weight-semibold mt-2">Please obtain the assignment by clicking on the button below:</p>
    <p><button class="button is-success" :class="{'is-loading': obtain_disabled}" :disabled="obtain_disabled" @click="obtain_assignment">Get Assignment</button></p>
  </div>
  <div v-else-if="assignment_not_yet_open">
    <p class="has-text-weight-semibold mt-2">The assignment will become available on {{date_available}}.</p>
  </div>
  <div v-else>
    <p class="has-text-weight-semibold mt-2">The instructor has not finalized the assignment yet. Check back later.</p>
  </div>
    
  <!-- Section for asking the homework to be graded. --> 

  <div v-if="drive_url && submission_open">
    <h2 class="subtitle mt-5">Submit Assignment</h2>
    <p>You can still request {{available_grades}} in these 24h.</p>
    <p class="mt-2"><b>Save your Colab notebook</b> before requesting grading.</p>
    <p>
      <button class="button is-danger mt-2" :disabled="is_grading" :class="{'is-loading': is_grading}" @click="grade_homework">Grade My Assignment</button>
    </p>

    <div class="box has-background-success-light has-text-success-dark mt-2" v-if="grading_outcome && !grading_error">
      {{grading_outcome}}
    </div>
    <div class="box has-background-danger-light has-text-danger-dark mt-2" v-if="grading_outcome && grading_error">
      {{grading_outcome}}
    </div>
    <div v-if="cell_source" class="control">
      <p class="has-text-danger-dark">Go to <a :href="drive_url" target="_blank">your assignment</a>,
        fix the error in the code cell depicted below, and request grading again:</p>
      <textarea class="textarea is-danger is-family-monospace is-size-7" type="text" :value="cell_source" readonly></textarea>
    </div>

  </div>
  
  <!-- Section displaying the grades -->
  
  <h2 class="subtitle mt-5">Your Grades
    <span @mouseover="show_grades_help = true" @mouseout="show_grades_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span></h2>
  <div class="box has-background-primary-light has-text-primary-dark" v-if="show_grades_help">
    <p>Below are the grades and feedback you received.
      Grades for late submissions are valid only if the instructor marks them so manually.
      Your assignment grade is the highest valid grade you received. 
    </p>
  </div>


  <div class="box has-background-primary-light has-text-primary-dark" v-if="show_table_help">
    <p>{{table_help}}</p>
  </div>
  <table v-if="grades.length > 0" class="table is-striped is-fullwidth">
    <tr>
      <th>Valid <span @mouseover="show_table_valid_help = true" @mouseout="show_table_valid_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span></th>
      <th>Grade</th>
      <th>Graded On</th>
      <th>Graded Assignment <span @mouseover="show_table_graded_help = true" @mouseout="show_table_graded_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span></th>
      <th v-if="ai_feedback_enabled">AI Feedback <span @mouseover="show_table_ai_help = true" @mouseout="show_table_ai_help = false" class="icon is-small has-text-primary"><i class="fa fa-info-circle"></i></span></th>
    </tr>
    <tr v-for="grade in grades">
      <td>{{grade.is_valid}}</td>
      <td>{{grade.grade_date}}</td>
      <td>{{grade.feedback}}</td>
      <td><ai_feedback_button :url="{{grade.ai_feedback_url}}"></td>
    </tr>

[[block page_scripts]]
<!-- Loads the index-specific js for Vue -->
<script>
    const homework_details_url = "[[=XML(homework_details_url)]]";
    const obtain_assignment_url = "[[=XML(obtain_assignment_url)]]";
    const grade_homework_url = "[[=XML(grade_homework_url)]]";
    const recent_grade_date_url = "[[=XML(recent_grade_date_url)]]";
    const error_url = "[[=XML(error_url)]]";
    const internal_error_url = "[[=XML(internal_error_url)]]";
</script>
<script src="components-bulma/vueform/luxon.min.js"></script>
<script src="[[=URL('static/components-bulma/grid/grid.js')]]"></script>
<script src="[[=URL('static/components-bulma/ai_feedback_button/ai_feedback_button.js')]]"></script>
<script src="js/homework.js"></script>
[[end]]
